# Netty幅度段启动过程源码分析

## 服务端Channel的创建 newChannel()
1. 从编写的代码`ChannelFuture f = b.bind(8888).sync();`开始进入
2. 再跳入如下方法中
```java
public ChannelFuture bind(int inetPort) {
    //1.再跳入bind
    return bind(new InetSocketAddress(inetPort));
}

public ChannelFuture bind(SocketAddress localAddress) {
    //2.验证有效性
    validate();
    if (localAddress == null) {
        throw new NullPointerException("localAddress");
    }
    //3.跳入最终的doBind
    return doBind(localAddress);
}

private ChannelFuture doBind(final SocketAddress localAddress) {
    //4.dobind中开始执行初始化和注册channel的操作
    final ChannelFuture regFuture = initAndRegister();
    //......
}

//初始化和注册的操作
final ChannelFuture initAndRegister() {

    Channel channel = null;
    try {
        //从这里开始执行创建channel了
        channel = channelFactory.newChannel();
        init(channel);
    } catch (Throwable t) {
        //.....
    }
    //......
}

//5.之前通过.channel(NioServerSocketChannel.class)传进来的NioServerSocketChannel会在这里赋值到对象里
public ReflectiveChannelFactory(Class<? extends T> clazz) {
    if (clazz == null) {
        throw new NullPointerException("clazz");
    }
    this.clazz = clazz;
}

@Override
public T newChannel() {
    try {
        //6.这里直接调用类的反射创建了一个channel出来
        return clazz.newInstance();
    } catch (Throwable t) {
        throw new ChannelException("Unable to create Channel from class " + clazz, t);
    }
}
```

## 初始化channel